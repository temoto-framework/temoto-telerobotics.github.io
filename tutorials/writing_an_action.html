

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Writing an Action &mdash; temoto_tutorials  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Using The Component Manager" href="using_the_component_manager.html" />
    <link rel="prev" title="Creating TeMoto Workspace" href="create_temoto_workspace.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> temoto_tutorials
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installing_temoto.html">Installing TeMoto</a></li>
<li class="toctree-l1"><a class="reference internal" href="create_temoto_workspace.html">Creating TeMoto Workspace</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Writing an Action</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#start-the-temoto-action-assistant">1) Start the TeMoto Action Assistant</a></li>
<li class="toctree-l2"><a class="reference internal" href="#create-your-umrf">2) Create your UMRF</a></li>
<li class="toctree-l2"><a class="reference internal" href="#generate-the-action-package">3) Generate the action package</a></li>
<li class="toctree-l2"><a class="reference internal" href="#modify-the-autogenerated-source">4) Modify the autogenerated source</a></li>
<li class="toctree-l2"><a class="reference internal" href="#build-and-test-the-action">5) Build and test the action</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="using_the_component_manager.html">Using The Component Manager</a></li>
<li class="toctree-l1"><a class="reference internal" href="tracing.html">Tracing</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">temoto_tutorials</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Writing an Action</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/writing_an_action.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="writing-an-action">
<h1>Writing an Action<a class="headerlink" href="#writing-an-action" title="Permalink to this headline">¶</a></h1>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This tutorial assumes that you are familiar with the concept of <a class="reference external" href="../../../temoto-telerobotics.github.io/site/concepts/actions">Actions and UMRFs</a> in TeMoto.</p>
</div>
<p>The basis for an action can be easily generated via TeMoto Action Assistant. Since the structure of an action is defined by its UMRF, the TeMoto Action Assistant provides the graphical interface for creating an UMRF. Once you are happy with the UMRF, a basis for action implementation package is generated, incuding a c++ source file.</p>
<p>For the sake of example, this tutorial helps to create a TeMoto Action, which accepts two numbers as an input and outputs the sum of the input numbers.</p>
<div class="figure align-center" id="id2">
<a class="reference internal image-reference" href="_images/action_engine_overview.png"><img alt="_images/action_engine_overview.png" src="_images/action_engine_overview.png" style="width: 600px;" /></a>
<p class="caption"><span class="caption-text"><strong>Fig. 0:</strong> Conceptual overview of how TeMoto Action Engine works.</span></p>
</div>
<div class="section" id="start-the-temoto-action-assistant">
<h2>1) Start the TeMoto Action Assistant<a class="headerlink" href="#start-the-temoto-action-assistant" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Follow the <em>“Creating TeMoto workspace</em>” tutorial if you haven’t created a TeMoto workspace yet.</p>
</div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>roslaunch YOUR_TEMOTO_WORKSPACE action_assistant.launch
</pre></div>
</div>
<p>This should bring up the start screen of the action assistant, depicted in Fig. 1. If you have a feeling that the Action Assistant looks awfully similar to MoveIt! Setup Assistant, then you are correct, it’s based on it. Click on the <em>“Create New TeMoto Action Package”</em> button.</p>
<div class="figure align-center" id="id3">
<a class="reference internal image-reference" href="_images/start_screen_umrf.png"><img alt="_images/start_screen_umrf.png" src="_images/start_screen_umrf.png" style="width: 400px;" /></a>
<p class="caption"><span class="caption-text"><strong>Fig. 1:</strong> Start screen of the TeMoto Action Assistant</span></p>
</div>
</div>
<div class="section" id="create-your-umrf">
<h2>2) Create your UMRF<a class="headerlink" href="#create-your-umrf" title="Permalink to this headline">¶</a></h2>
<p>Go to the <em>“UMRF Editor”</em> tab (depicted in Fig. 2). This tab consists of 2 main sections:</p>
<blockquote>
<div><ul class="simple">
<li><strong>UMRF Viewer</strong> section, which visually shows the structure of the UMRF.</li>
<li><strong>Item Editor</strong> section, which allows to edit the currently active item in the UMRF Viewer.</li>
</ul>
</div></blockquote>
<div class="figure align-center" id="id4">
<a class="reference internal image-reference" href="_images/umrf_editor_expl_umrf.png"><img alt="_images/umrf_editor_expl_umrf.png" src="_images/umrf_editor_expl_umrf.png" style="width: 450px;" /></a>
<p class="caption"><span class="caption-text"><strong>Fig. 2:</strong> UMRF Editor tab</span></p>
</div>
<ul class="simple">
<li>Modify the name by clicking on the “Name:” item in the UMRF viewer and changing the name in the item editor. In the given example, let’s call it <em>“add numbers”</em> (TODO: the name field has a bug, so ignore the name part)</li>
<li>Add new input parameter by right-clicking on the “Input Parameters” item and selecing “Add new parameter”.</li>
<li>Select the newly created parameter and change it’s name to <em>“input_1”</em> and it’s type to <em>“number”</em> (shown in Fig. 3).</li>
<li>Add another input parameter and change it’s name to <em>“input_2”</em> and it’s type to <em>“number”</em>.</li>
<li>Add an output parameter change it’s name to <em>“output_1”</em> and it’s type to <em>“number”</em>.</li>
</ul>
<p>The UMRF is now done (end result shown in Fig. 4).</p>
<div class="figure align-center" id="id5">
<a class="reference internal image-reference" href="_images/add_parameter_umrf.png"><img alt="_images/add_parameter_umrf.png" src="_images/add_parameter_umrf.png" style="width: 450px;" /></a>
<p class="caption"><span class="caption-text"><strong>Fig. 3:</strong> Modify new input parameter</span></p>
</div>
<div class="figure align-center" id="id6">
<a class="reference internal image-reference" href="_images/final_umrf.png"><img alt="_images/final_umrf.png" src="_images/final_umrf.png" style="width: 450px;" /></a>
<p class="caption"><span class="caption-text"><strong>Fig. 4:</strong> UMRF done</span></p>
</div>
</div>
<div class="section" id="generate-the-action-package">
<h2>3) Generate the action package<a class="headerlink" href="#generate-the-action-package" title="Permalink to this headline">¶</a></h2>
<p>Go to the <em>“Generate Action”</em> tab (depicted in Fig. 5).</p>
<ul class="simple">
<li>Name the action via <em>“Action Package Name”</em> field. The names are automatically forced to follow the <a class="reference external" href="http://www.ros.org/reps/rep-0144.html">ROS package naming convention</a>. So don’t be surprised if you cannot use capital letters and whitespaces. Additionally, a prefix of <em>“ta_”</em> is added, which stands for TeMoto Action.</li>
<li>Since this tutorial assumes that the Action Assistant was opened via TeMoto workspace (see the first step in this tutorial), then the directory where the action will be generated is automatically set. If that’s not the case then select the directory where the action package is generated.</li>
<li>Generate the package by clicking the <em>“Generate”</em> button.</li>
</ul>
<div class="figure align-center" id="id7">
<a class="reference internal image-reference" href="_images/generate_action_umrf.png"><img alt="_images/generate_action_umrf.png" src="_images/generate_action_umrf.png" style="width: 450px;" /></a>
<p class="caption"><span class="caption-text"><strong>Fig. 5:</strong> Generate Action tab</span></p>
</div>
</div>
<div class="section" id="modify-the-autogenerated-source">
<h2>4) Modify the autogenerated source<a class="headerlink" href="#modify-the-autogenerated-source" title="Permalink to this headline">¶</a></h2>
<p>Now navigate to the generated package and open the <a class="reference external" href="../../../temoto-telerobotics.github.io/site/concepts/actions">action</a> source file with your favourite editor. For example:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> YOUR_TEMOTO_WORKSPACE/actions/ta_add_numbers/src
gedit ta_add_numbers.cpp
</pre></div>
</div>
<p>The <a class="reference external" href="../../../temoto-telerobotics.github.io/site/concepts/actions">action</a> source file contains a bunch of things that are necessary for TeMoto, but we are going to focus on a <code class="docutils literal notranslate"><span class="pre">executeTemotoAction()</span></code> function. This function is invoked when the action is executed.</p>
<p>Locate the block comment which says “YOUR CODE HERE”:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">executeTemotoAction</span><span class="p">()</span>
<span class="p">{</span>
  <span class="c1">// Input parameters</span>
  <span class="kt">double</span> <span class="n">input_1</span> <span class="o">=</span> <span class="n">GET_PARAMETER</span><span class="p">(</span><span class="s">&quot;input_1&quot;</span><span class="p">,</span> <span class="kt">double</span><span class="p">);</span>
  <span class="kt">double</span> <span class="n">input_2</span> <span class="o">=</span> <span class="n">GET_PARAMETER</span><span class="p">(</span><span class="s">&quot;input_2&quot;</span><span class="p">,</span> <span class="kt">double</span><span class="p">);</span>

  <span class="c1">// Declaration of output parameters</span>
  <span class="kt">double</span> <span class="n">output_1</span><span class="p">;</span>

  <span class="cm">/* * * * * * * * * * * * * *</span>
<span class="cm">  *</span>
<span class="cm">  * ===&gt; YOUR CODE HERE &lt;===</span>
<span class="cm">  *</span>
<span class="cm">  * * * * * * * * * * * * * */</span>

  <span class="c1">// Pass the output parameters to the action engine</span>
  <span class="n">SET_PARAMETER</span><span class="p">(</span><span class="s">&quot;output_1&quot;</span><span class="p">,</span> <span class="s">&quot;double&quot;</span><span class="p">,</span> <span class="n">output_1</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>and replace it with code that adds up the numbers and puts the result to the output parameter <code class="docutils literal notranslate"><span class="pre">output_1</span></code></p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">executeTemotoAction</span><span class="p">()</span>
<span class="p">{</span>
  <span class="c1">// Input parameters</span>
  <span class="kt">double</span> <span class="n">input_1</span> <span class="o">=</span> <span class="n">GET_PARAMETER</span><span class="p">(</span><span class="s">&quot;input_1&quot;</span><span class="p">,</span> <span class="kt">double</span><span class="p">);</span>
  <span class="kt">double</span> <span class="n">input_2</span> <span class="o">=</span> <span class="n">GET_PARAMETER</span><span class="p">(</span><span class="s">&quot;input_2&quot;</span><span class="p">,</span> <span class="kt">double</span><span class="p">);</span>

  <span class="c1">// Declaration of output parameters</span>
  <span class="kt">double</span> <span class="n">output_1</span><span class="p">;</span>

  <span class="c1">// Add the input numbers and put the result into the output variable</span>
  <span class="n">output_1</span> <span class="o">=</span> <span class="n">input_1</span> <span class="o">+</span> <span class="n">input_2</span><span class="p">;</span>
  <span class="n">TEMOTO_INFO_STREAM</span><span class="p">(</span><span class="s">&quot;Adding numbers &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">input_1</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; and &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">input_2</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;. Result is &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">output_1</span><span class="p">);</span>

  <span class="c1">// Pass the output parameters to the action engine</span>
  <span class="n">SET_PARAMETER</span><span class="p">(</span><span class="s">&quot;output_1&quot;</span><span class="p">,</span> <span class="s">&quot;double&quot;</span><span class="p">,</span> <span class="n">output_1</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Do not modify any of the autogenerated code. Otherwise your action will likely not work properly.</p>
</div>
</div>
<div class="section" id="build-and-test-the-action">
<h2>5) Build and test the action<a class="headerlink" href="#build-and-test-the-action" title="Permalink to this headline">¶</a></h2>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>catkin build
<span class="c1"># (source your workspace)</span>
roslaunch NAME_OF_YOUR_ACTION action_test_standalone.launch
</pre></div>
</div>
<p>If you followed this tutorial step-by-step, then you should see this in the terminal output:</p>
<div class="highlight-terminal notranslate"><div class="highlight"><pre><span></span>[ INFO] [1569253106.131552856]: Adding numbers 0 and 0. Result is 0
</pre></div>
</div>
<p>You can change the input values (denoted as <code class="docutils literal notranslate"><span class="pre">pvf_value</span></code>) by modifying the <cite>test/invoker_umrf.json</cite> under your action package root folder like so:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;TaAddNumbers&quot;</span><span class="p">,</span>
    <span class="nt">&quot;package_name&quot;</span><span class="p">:</span> <span class="s2">&quot;ta_add_numbers&quot;</span><span class="p">,</span>
    <span class="nt">&quot;suffix&quot;</span><span class="p">:</span> <span class="s2">&quot;0&quot;</span><span class="p">,</span>
    <span class="nt">&quot;notation&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="nt">&quot;effect&quot;</span><span class="p">:</span> <span class="s2">&quot;synchronous&quot;</span><span class="p">,</span>
    <span class="nt">&quot;input_parameters&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;input_1&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;pvf_type&quot;</span><span class="p">:</span> <span class="s2">&quot;number&quot;</span><span class="p">,</span>
            <span class="nt">&quot;pvf_value&quot;</span><span class="p">:</span> <span class="mf">8.4</span>
        <span class="p">},</span>
        <span class="nt">&quot;input_2&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;pvf_type&quot;</span><span class="p">:</span> <span class="s2">&quot;number&quot;</span><span class="p">,</span>
            <span class="nt">&quot;pvf_value&quot;</span><span class="p">:</span> <span class="mf">1.2</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="nt">&quot;output_parameters&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;output_1&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;pvf_type&quot;</span><span class="p">:</span> <span class="s2">&quot;number&quot;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>… and terminal output should contain:</p>
<div class="highlight-terminal notranslate"><div class="highlight"><pre><span></span>[ INFO] [1569253446.766320331]: Adding numbers 8.4 and 1.2. Result is 9.6
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="using_the_component_manager.html" class="btn btn-neutral float-right" title="Using The Component Manager" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="create_temoto_workspace.html" class="btn btn-neutral float-left" title="Creating TeMoto Workspace" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, TeMoto Telerobotics

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>